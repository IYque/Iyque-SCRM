import{r as e}from"./request-DbwU2Jpl.js";import{_ as t}from"../index-B0mVr8eT.js";import{V as a,o as l,c as s,i,H as o,F as r,R as u,G as d,_ as m,$ as n,a as p,L as c,I as g}from"./_@vue_runtime-core@3.4.29@@vue-DDZ-_xUj.js";import{v as f}from"./_@vue_runtime-dom@3.4.29@@vue-DFFRdgB0.js";import"./_axios@1.7.2@axios-CURSphCx.js";import"./_element-plus@2.7.5@element-plus-CdApmuLJ.js";import"./_@vue_reactivity@3.4.29@@vue-Ujt3kFWg.js";import"./_@vue_shared@3.4.29@@vue-CbMJA9y8.js";import"./_lodash-es@4.17.21@lodash-es-Bg5u8xPa.js";import"./_@vueuse_shared@9.13.0@@vueuse-UyGL86A6.js";import"./_@vueuse_core@9.13.0@@vueuse-CEW8sd95.js";import"./_@element-plus_icons-vue@2.3.1@@element-plus-CcmeDuPu.js";import"./_@sxzz_popperjs-es@2.11.7@@sxzz-D3lHDW-0.js";import"./_@ctrl_tinycolor@3.6.1@@ctrl-D2oWfImC.js";import"./_dayjs@1.11.11@dayjs-t441MSVg.js";import"./_async-validator@4.2.5@async-validator-Cuo4gI4y.js";import"./_memoize-one@6.0.0@memoize-one-Ds0C_khL.js";import"./_normalize-wheel-es@1.2.0@normalize-wheel-es-Vn5vHDCm.js";import"./_@floating-ui_dom@1.6.5@@floating-ui-e4X2zpze.js";import"./_@floating-ui_core@1.6.2@@floating-ui-wf05fRq8.js";import"./_@floating-ui_utils@0.2.2@@floating-ui-Olnmr9Km.js";import"./_js-cookie@3.0.5@js-cookie-BXEMiIsG.js";/* empty css                                           */import"./_vue-router@4.3.3@vue-router-DcBx9OIa.js";import"./_path-browserify@1.0.1@path-browserify-Ce3DhMlR.js";import"./_pinia@2.1.7@pinia-Cpvd85vB.js";import"./_vue-demi@0.14.8@vue-demi-Dq6ymT-8.js";import"./_@vueuse_core@10.11.0@@vueuse-Djca5FhE.js";import"./_@vueuse_shared@10.11.0@@vueuse-C8Crp58W.js";import"./_nprogress@0.2.0@nprogress-DSZB-OSK.js";const{get:h,post:_,put:v,delt:b}=e,w="/iyQue",j=e=>_(`${w}/save`,e);function y(e){return v(`${w}/update`,e)}const V={props:{data:{}},data:()=>({rules:{codeName:[{required:!0,message:"请输入活码名称",trigger:"blur"}],users:[{required:!0,message:"请选择",trigger:"change",validator:(e,t,a)=>{0==t.length?a(new Error("请选择")):a()}}]},form:{codeName:"",skipVerify:1,tags:[],users:[]},selectedUserList:[],selectedTagList:[],userList:[],userErrorTip:"",tagList:[],tagErrorTip:""}),watch:{data:{deep:!0,immediate:!0,handler(e){let t=JSON.parse(JSON.stringify(e));t.tags=[],t.users=[],t.tagId&&t.tagName&&(t.tagId=t.tagId.split(","),t.tagName=t.tagName.split(","),t.tagId.forEach(((e,a)=>{t.tags.push({id:e,name:t.tagName[a]})}))),t.userId&&t.userName&&(t.userId=t.userId.split(","),t.userName=t.userName.split(","),t.userId.forEach(((e,a)=>{t.users.push({id:e,name:t.userName[a]})}))),this.form=t,setTimeout((()=>{this.$refs.form.clearValidate()}),0)}}},created(){this.getUserList(),this.getTagList()},methods:{getUserList(){var t;e({url:"/iYqueUser/findIYqueUser",params:t}).then((e=>{var t;return 200==e.code&&(null==(t=e.data)||t.forEach((e=>{e.id=e.userId}))),e})).then((e=>{301!=e.code?this.userList=e.data||[]:this.userErrorTip=e.msg}))},getTagList(){var t;e({url:"/iYqueTag/findIYqueTag",params:t}).then((e=>{301!=e.code?this.tagList=e.data||[]:this.tagErrorTip=e.msg}))},getDetail(e){(e=>h(`${w}/findIYqueUserCode/${e}`))(e).then((e=>{e.data.forEach((e=>{e.tagId&&e.tagName&&(e.tagId=e.tagId.split(","),e.tagName=e.tagName.split(","),e.tags=[],e.tagId.forEach(((t,a)=>{e.tags.push({id:t,name:e.tagName[a]})}))),e.userId&&e.userName&&(e.userId=e.userId.split(","),e.userName=e.userName.split(","),e.users=[],e.userId.forEach(((t,a)=>{e.users.push({id:t,name:e.userName[a]})})))})),this.form=e.data}))},async submit(){if(await this.$refs.form.validate())return this.form.tagId=this.form.tags.map((e=>e.id))+"",this.form.tagName=this.form.tags.map((e=>e.name))+"",this.form.userId=this.form.users.map((e=>e.id))+"",this.form.userName=this.form.users.map((e=>e.name))+"",this.$store.loading=!0,(this.form.id?y:j)(this.form).then((({data:e})=>{this.msgSuccess("操作成功"),this.$router.back()})).finally((()=>{this.$store.loading=!1}))}}},N=e=>(m("data-v-4a600924"),e=e(),n(),e),I={class:"g-card"},k=N((()=>p("div",{class:"g-tip"},"（注:勾选后,客户添加员工好友无需员工确认）",-1))),x=N((()=>p("div",{class:"g-tip"},"（注:开启后，同一个企业的客户会优先添加到同一个跟进人）",-1)));const q={data:()=>({loading:!1,query:{page:0,size:10},list:"",total:0,multipleSelection:[],dialogVisible:!1,form:{}}),components:{aev:t(V,[["render",function(e,t,m,n,p,c){const g=a("el-input"),f=a("el-form-item"),h=a("el-option"),_=a("el-select"),v=a("el-switch"),b=a("TextareaExtend"),w=a("el-form");return l(),s("div",I,[i(w,{ref:"form",rules:p.rules,model:p.form,"label-position":"right","label-width":"100px"},{default:o((()=>[i(f,{label:"活码名称",prop:"codeName"},{default:o((()=>[i(g,{modelValue:p.form.codeName,"onUpdate:modelValue":t[0]||(t[0]=e=>p.form.codeName=e),maxlength:"15","show-word-limit":"",clearable:"",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),i(f,{label:"活码员工",prop:"users",error:p.userErrorTip},{default:o((()=>[i(_,{modelValue:p.form.users,"onUpdate:modelValue":t[1]||(t[1]=e=>p.form.users=e),"value-key":"id",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,placeholder:"请选择"},{default:o((()=>[(l(!0),s(r,null,u(p.userList,(e=>(l(),d(h,{key:e.id,label:e.name,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["error"]),i(f,{label:"免验证"},{default:o((()=>[i(v,{modelValue:p.form.skipVerify,"onUpdate:modelValue":t[2]||(t[2]=e=>p.form.skipVerify=e)},null,8,["modelValue"]),k])),_:1}),i(f,{label:"重复添加"},{default:o((()=>[i(v,{modelValue:p.form.isExclusive,"onUpdate:modelValue":t[3]||(t[3]=e=>p.form.isExclusive=e)},null,8,["modelValue"]),x])),_:1}),i(f,{label:"新客标签",error:p.tagErrorTip},{default:o((()=>[i(_,{modelValue:p.form.tags,"onUpdate:modelValue":t[4]||(t[4]=e=>p.form.tags=e),"value-key":"id",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,placeholder:"请选择"},{default:o((()=>[(l(!0),s(r,null,u(p.tagList,(e=>(l(),d(h,{key:e.id,label:e.name,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["error"]),i(f,{label:"欢迎语"},{default:o((()=>[i(b,{modelValue:p.form.weclomeMsg,"onUpdate:modelValue":t[5]||(t[5]=e=>p.form.weclomeMsg=e),toolbar:["emoji","insertCustomerNickName"],maxlength:"2000","show-word-limit":"",placeholder:"请输入",autosize:{minRows:5,maxRows:20},clearable:"",autofocus:!1},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])}],["__scopeId","data-v-4a600924"]])},watch:{},created(){this.getList()},mounted(){},methods:{getList(e){var t;e&&(this.query.page=e),this.loading=!0,(t=this.query,h(`${w}/findIYqueUserCode`,t)).then((({data:e,count:t})=>{this.list=e,this.total=+t,this.loading=!1,this.multipleSelection=[]})).catch((()=>{this.loading=!1}))},del(e){var t,a;let l=e||(null==(a=null==(t=this.multipleSelection)?void 0:t.join)?void 0:a.call(t,","));if(!l)return this.msgError("请选择需要删除的数据");this.$confirm().then((()=>(this.loading=!0,(e=>b(`${w}/${e}`))(l).then((e=>{this.msgSuccess("删除成功"),this.getList()}))))).catch((e=>{})).finally((()=>{this.loading=!1}))}}},U=(e=>(m("data-v-c8b49315"),e=e(),n(),e))((()=>p("div",{class:"warning"},[p("a",{href:"https://www.iyque.cn?utm_source=iyquecode",target:"_blank"},[p("strong",null,"源雀SCRM — 基于SpringCloud+Vue架构,100%开放源码的企微私域营销系统:https://www.iyque.cn/")])],-1))),E={class:"g-card"},L={class:"fxbw"};const C=t(q,[["render",function(e,t,r,u,d,m){const n=a("el-button"),h=a("el-table-column"),_=a("el-image"),v=a("TagEllipsis"),b=a("el-table"),w=a("pagination"),j=a("aev"),y=a("el-dialog");return l(),s("div",null,[U,p("div",E,[p("div",L,[i(n,{type:"primary",onClick:t[0]||(t[0]=e=>{d.form={},d.dialogVisible=!0})},{default:o((()=>[c("新建")])),_:1}),i(n,{disabled:!d.multipleSelection.length,onClick:t[1]||(t[1]=e=>m.del()),type:"danger"},{default:o((()=>[c("批量删除")])),_:1},8,["disabled"])]),i(b,{data:d.list,"tooltip-effect":"dark","highlight-current-row":"",onSelectionChange:t[2]||(t[2]=e=>d.multipleSelection=e.map((e=>e.id)))},{default:o((()=>[i(h,{type:"selection",width:"50",align:"center"}),i(h,{label:"活码名称",prop:"codeName","show-overflow-tooltip":""}),i(h,{label:"活码地址",prop:"codeUrl","show-overflow-tooltip":""},{default:o((({row:e})=>[i(_,{src:e.codeUrl,style:{width:"100px"}},null,8,["src"])])),_:1}),i(h,{label:"使用员工"},{default:o((({row:e})=>[i(v,{list:e.userName},null,8,["list"])])),_:1}),i(h,{label:"标签"},{default:o((({row:e})=>[i(v,{list:e.tagName},null,8,["list"])])),_:1}),i(h,{label:"更新时间",prop:"updateTime"}),i(h,{label:"操作",fixed:"right"},{default:o((({row:t})=>[i(n,{text:"",onClick:e=>{d.form=JSON.parse(JSON.stringify(t)),d.dialogVisible=!0}},{default:o((()=>[c("编辑")])),_:2},1032,["onClick"]),i(n,{text:"",onClick:e=>m.del(t.id)},{default:o((()=>[c("删除")])),_:2},1032,["onClick"]),i(n,{text:"",onClick:a=>e.downloadBlob(t.codeUrl,t.codeName)},{default:o((()=>[c("活码下载")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),g(i(w,{total:d.total,page:d.query.page,"onUpdate:page":t[3]||(t[3]=e=>d.query.page=e),limit:d.query.size,"onUpdate:limit":t[4]||(t[4]=e=>d.query.size=e),onPagination:t[5]||(t[5]=e=>m.getList())},null,8,["total","page","limit"]),[[f,d.total>0]])]),i(y,{title:d.form.id?"编辑":"新建",modelValue:d.dialogVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>d.dialogVisible=e),width:"50%"},{footer:o((()=>[i(n,{onClick:t[6]||(t[6]=e=>d.dialogVisible=!1)},{default:o((()=>[c("取消")])),_:1}),i(n,{type:"primary",onClick:t[7]||(t[7]=t=>(e.$refs.aev.submit(),d.dialogVisible=!1))},{default:o((()=>[c("确定")])),_:1})])),default:o((()=>[i(j,{data:d.form,ref:"aev"},null,8,["data"])])),_:1},8,["title","modelValue"])])}],["__scopeId","data-v-c8b49315"]]);export{C as default};
